---
import { Image } from 'astro:assets';
import type { ImageMetadata } from 'astro';

interface Props {
  path: string; // Percorso relativo a src/assets, es. "images/evento"
}

const { path } = Astro.props;

// Carica tutte le immagini dalla cartella assets
// Nota: import.meta.glob richiede stringhe letterali per il pattern, quindi carichiamo tutto e filtriamo
const allImages = import.meta.glob<{ default: ImageMetadata }>('/src/assets/**/*.{jpeg,jpg,png,gif,webp}', { eager: true });

// Filtra le immagini che corrispondono al percorso specificato
const images = Object.entries(allImages)
  .filter(([key]) => key.includes(path))
  .map(([_, mod]) => mod.default);
---

<div class="carousel-container">
  <div class="carousel">
    {images.length > 0 ? (
      images.map((image, index) => (
        <div class="carousel-item">
          <Image src={image} alt={`Slide ${index + 1}`} class="carousel-image" />
        </div>
      ))
    ) : (
      <p class="no-images">Nessuna immagine trovata in: {path}</p>
    )}
  </div>
</div>

<style>
  .carousel-container {
    width: 100%;
    overflow: hidden;
    padding: 1rem 0;
  }

  .carousel {
    display: flex;
    overflow-x: auto;
    scroll-snap-type: x mandatory;
    gap: 1rem;
    padding: 0 1rem;
    -webkit-overflow-scrolling: touch; /* Per scorrimento fluido su mobile */
    scrollbar-width: none; /* Nasconde scrollbar su Firefox */
  }

  .carousel::-webkit-scrollbar {
    display: none; /* Nasconde scrollbar su Chrome/Safari */
  }

  .carousel-item {
    flex: 0 0 85%; /* Mostra parzialmente la slide successiva */
    scroll-snap-align: center;
    border-radius: 0.5rem;
    overflow: hidden;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
  }

  @media (min-width: 768px) {
    .carousel-item {
      flex: 0 0 45%; /* Su desktop mostra pi√π slide */
    }
  }

  .carousel-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
  }

  .no-images {
    text-align: center;
    width: 100%;
    color: #666;
    padding: 2rem;
  }
</style>
